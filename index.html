<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>UMBC Parking Live</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f7f7fb;--card:#fff;--text:#111;--muted:#666;--border:#e5e7eb;--easy:#e8f7ee;--busy:#fff7db;--packed:#fde7e7}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:800px;margin:0 auto;padding:20px}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.h1{font-size:22px;font-weight:700}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.badge{display:inline-flex;align-items:center;border:1px solid var(--border);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:8px}
.status-easy{background:var(--easy);color:#0f7a39;border-color:#bfe7cc}
.status-busy{background:var(--busy);color:#8a6a00;border-color:#f3e2a0}
.status-packed{background:var(--packed);color:#8a1c1c;border-color:#f6bcbc}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.pill{border:1px solid var(--border);padding:6px 10px;border-radius:12px;font-weight:700;font-size:14px;background:#fff;cursor:pointer}
.pill:hover{background:#f8fafc}
.hint{font-size:12px;color:#muted;margin-top:6px}
.footer{margin-top:16px;color:#555;font-size:12px;text-align:center}
.banner{margin:8px 0;padding:8px 10px;border:1px solid var(--border);border-radius:10px;font-size:13px;display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="header"><div class="h1">UMBC Parking Live</div></div>
  <div id="banner" class="banner"></div>
  <div id="lots"></div>
  <div class="footer">Not affiliated with UMBC Parking Services. Do not interact while driving.</div>
</div>
<script>
const lots=[{id:"lot1",name:"Lot 1"},{id:"lot3",name:"Lot 3"},{id:"lot4",name:"Lot 4"},{id:"stadium",name:"Stadium Lot"},{id:"commons-garage",name:"Commons Drive Garage"},{id:"lot25",name:"Lot 25"},{id:"lot31",name:"Lot 31"},{id:"lot29",name:"Lot 29"},{id:"lot22",name:"Lot 22"}]
const ENDPOINT="https://api.npoint.io/9b7a2cce7a36d16b4bfe"
const API_KEY=""
const L=document.getElementById("lots")
const B=document.getElementById("banner")
function badgeClass(s){if(s==="Easy")return"badge status-easy";if(s==="Getting Full")return"badge status-busy";if(s==="Packed")return"badge status-packed";return"badge"}
function now(){return Date.now()}
function minutes(ms){return Math.floor((Date.now()-ms)/60000)}
function showMsg(txt){B.textContent=txt;B.style.display="block"}
function hideMsg(){B.style.display="none"}
function render(data){
  L.innerHTML="";
  lots.forEach(l=>{
    const r=data[l.id]||{};
    const card=document.createElement("div");
    card.className="card";
    const title=document.createElement("div");
    title.innerHTML='<strong>'+l.name+'</strong> '+(r.status?('<span class="'+badgeClass(r.status)+'">'+r.status+"</span>"):"");
    const actions=document.createElement("div");
    actions.className="actions";
    ["Easy","Getting Full","Packed"].forEach(s=>{
      const b=document.createElement("button");
      b.className="pill";
      b.textContent=s;
      b.onclick=()=>submit(l.id,s);
      actions.appendChild(b);
    });
    card.appendChild(title);
    card.appendChild(actions);
    if(r.ts){
      const hint=document.createElement("div");
      hint.className="hint";
      hint.textContent="Last updated "+minutes(r.ts)+"m ago";
      card.appendChild(hint);
    }
    L.appendChild(card);
  });
}
async function getData(){
  try{
    const res=await fetch(ENDPOINT,{cache:"no-store"});
    if(!res.ok){showMsg("Error loading data ("+res.status+")");return {}}
    const data=await res.json();
    hideMsg();
    return data||{};
  }catch(e){
    showMsg("Error loading data");
    return {};
  }
}
async function putData(data){
  try{
    const headers={"Content-Type":"application/json"};
    if(API_KEY) headers["X-Api-Key"]=API_KEY;
    const res=await fetch(ENDPOINT,{method:"PUT",headers,body:JSON.stringify(data)});
    if(!res.ok){showMsg("Writes blocked ("+res.status+").")}
  }catch(e){
    showMsg("Network error saving");
  }
}
let model={}
render(model)
async function refresh(){model=await getData();render(model)}
async function submit(id,status){model[id]={status,ts:now()};render(model);await putData(model)}
refresh()
setInterval(refresh,8000)
</script>
</body>
</html>
